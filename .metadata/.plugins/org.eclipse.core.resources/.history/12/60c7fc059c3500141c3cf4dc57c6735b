package twgitter.get;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.net.URI;
import java.net.URLConnection;
import java.util.List;
import java.util.Map;

public class GetHTTP {
	/**
	 * HTTP接続して内容を取得
	 * @param URI アクセスするURI
	 * @param Header 必要なヘッダを設定（Header[?][0]が名前、[?][1]が内容）
	 * @param CharCode 文字コード設定(ない場合はJISAutoDetect)
	 * @return HTTPの内容
	 * @throws Exception
	 */
	public static StringBuilder AccessHTTP(String URI,String[][] Header,String CharCode) throws Exception {
		StringBuilder out = new StringBuilder();
		// 引数からURIを生成
		URI uri = new URI(URI);

		// URI -> URL -> URLConnection の順で接続インスタンスを取得
		URLConnection connection = uri.toURL().openConnection();

		//ヘッダ設定
		if(!(Header[0][0].equals("") && Header[0][1].equals("")))
		{
			for(int i=0;i<Header.length;i++)
			{
				connection.setRequestProperty(Header[i][0] ,Header[i][1]);
			}
		}

        // ヘッダ情報を出力
		Map<String, List<String>> headers = connection.getHeaderFields();
		for (Object key : headers.keySet()) {
			System.out.println("[Misc]HTTP Headers{" + key + ": " + headers.get(key) + "}");
		}



		// コンテンツを出力
		BufferedReader reader = new BufferedReader(new InputStreamReader(connection.getInputStream(), CharCode));
		String buffer = reader.readLine();
		System.out.println("[Misc]Successed to get HTTP");
		while(null != buffer)
		{
			out.append(buffer);
			System.out.println("G:" + buffer);
			buffer = reader.readLine();
		}

		return out;
	}

	public static StringBuilder AccessHTTP(String URI,String[][] Header) throws Exception{
		String CharCode1 = "JISAutoDetect";
		StringBuilder ret1 = AccessHTTP(URI,Header,CharCode1);

		return ret1;
	}

	public static StringBuilder AccessHTTP(String URI,String CharCode) throws Exception{
		String Header1[][] = {{""},{""}};
		StringBuilder ret2 = AccessHTTP(URI,Header1,CharCode);

		return ret2;
	}

	public static StringBuilder AccessHTTP(String URI) throws Exception{
		String CharCode2 = "JISAutoDetect";
		String Header2[][] = {{""},{""}};
		StringBuilder ret3 = AccessHTTP(URI,Header2,CharCode2);

		return ret3;
	}
}
