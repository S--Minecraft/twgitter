package twgitter.slack;

import java.sql.Timestamp;
import java.util.Date;
import java.util.List;

public class HistoryGetting {
	public static void main(String[] args) throws Exception {
		Date now = new Date(0);

		List<Message> messages = GetChannelHistory.jsonToMessage(GetChannelHistory.getChannelHistory("general"));
		List<User> users = GetUsers.jsonToUser(GetUsers.getUsers());

		for(int i=messages.size()-1;i>-1;i--)
		{
			Message thisM = messages.get(i);
			String id = "";
			String subtype = thisM.getSubtype();

			if(messages.get(0).getTsDate().after(now))
			{
				if(subtype!=null)
				{
					if(subtype.equals("message_changed"))
					{
						id = thisM.getMessage().getUser();
					}
					if(subtype.equals("file_share")||subtype.equals("channel_join"))
					{
						id = thisM.getUser();
					}
				}else{
					id = thisM.getUser();
				}

				String name = GetUsers.userIdToName(id,users);

				System.out.println("[Slack][" + name + "]" + thisM.getText());
			}
		}
	}

	public static Date timestampToDate(String ts)
	{
		Timestamp time = Timestamp.valueOf(ts);

		Date date = new Date(time.getTime());
		return date;
	}
}
