import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.net.URI;
import java.net.URLConnection;
import java.util.Map;

import twgitter.gitter.GetRooms;
import twgitter.gitter.config.Config;

public class Test {
    public static void main(String[] argv) throws Exception {
    	String streamRoomId = GetRooms.roomNameToId("S--Minecraft/twgitter");

        // 引数からURIを生成
        URI uri = new URI("https://stream.gitter.im/v1/rooms/" + streamRoomId + "/chatMessages");

        // URI -> URL -> URLConnection の順で接続インスタンスを取得
        URLConnection connection = uri.toURL().openConnection();

        //ヘッダ設定
        connection.setRequestProperty("Authorization", "Bearer " + Config.token);
        connection.setRequestProperty("Accept", "application/json");

        // ヘッダ情報を出力
        Map headers = connection.getHeaderFields();
        for (Object key : headers.keySet()) {
            System.out.println(key + ": " + headers.get(key));
        }

        // コンテンツを出力
        BufferedReader reader = new BufferedReader(new InputStreamReader(connection.getInputStream(), "UTF-8"));
        String buffer = reader.readLine();
        System.out.println();
        while (null != buffer) {
            System.out.println(buffer);
            buffer = reader.readLine();
        }
    }
}
